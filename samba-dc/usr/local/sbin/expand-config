#!/bin/bash

#
# Copyright (C) 2022 Nethesis S.r.l.
# SPDX-License-Identifier: GPL-3.0-or-later
#

set -e

REALM=${REALM:?}
IPADDRESS=${IPADDRESS:?}
HOSTNAME=${HOSTNAME:?}

cat - > /etc/krb5.conf <<EOF
# generated by $0
[libdefaults]
        default_realm = ${REALM^^}
        dns_lookup_realm = false
        dns_lookup_kdc = true

[realms]
${REALM^^} = {
        default_domain = ${REALM,,}
}

[domain_realm]
        ${REALM,,} = ${REALM^^}
EOF

cat - > /etc/hosts <<EOF
127.0.0.1     localhost.localdomain localhost
${IPADDRESS}     ${HOSTNAME}
EOF

cat - > /etc/resolv.conf <<EOF
search ${REALM,,}
nameserver ${IPADDRESS}
EOF
